<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test d'affichage de l'image avec cache</title>
  <style>
    #profile-picture {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background-color: #e0e0e0;
      background-size: cover;
      background-position: center;
    }
  </style>
</head>
<body>
  <div id="profile-picture"></div>

  <script>
    // Fonction pour récupérer un cookie par son nom
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }

    async function fetchProfilePicture() {
      const uniqueId = getCookie("uniqueId");  // Récupérer l'ID unique à partir des cookies

      if (!uniqueId) {
        console.error("UniqueId introuvable dans les cookies.");
        return;
      }

      // Vérifier si l'image est déjà en cache dans localStorage
      const cachedImage = localStorage.getItem(`profile-picture-${uniqueId}`);
      if (cachedImage) {
        console.log("Image trouvée dans le cache.");
        const profilePicture = document.getElementById("profile-picture");
        profilePicture.style.backgroundImage = `url(${cachedImage})`;
        return; // Si l'image est en cache, ne pas envoyer la requête
      }

      try {
        const response = await fetch(`/profile-picture/${uniqueId}`);
        const data = await response.json();

        if (data.success && data.imageUrl) {
          // Enregistrer l'URL de l'image dans le cache
          localStorage.setItem(`profile-picture-${uniqueId}`, data.imageUrl);

          // Afficher l'image
          const profilePicture = document.getElementById("profile-picture");
          profilePicture.style.backgroundImage = `url(${data.imageUrl})`;
        } else {
          console.error("Erreur dans la réponse du serveur.");
        }
      } catch (error) {
        console.error("Erreur lors de la récupération de l'image :", error);
      }
    }

    document.addEventListener("DOMContentLoaded", fetchProfilePicture);
  </script>
</body>
</html>
