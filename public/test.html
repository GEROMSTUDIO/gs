<!DOCTYPE html>
<html lang="fr">
  <head>
    <style>
      body {
        background-color: rgb(0, 0, 0);
      }
    </style>
    <meta charset="UTF-8" />
    <title>Vérification d'Accès</title>
    <div id="importedContent"></div>
    <script>
      // Fonction pour récupérer un cookie par son nom
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
        return null;
      }

      function checkAccess() {
        const uniqueId = getCookie("uniqueId");

        if (!uniqueId) {
          document.getElementById("message").textContent =
            "Aucun identifiant trouvé. Veuillez vous connecter.";
          window.location.href = `/login.html`;
          return;
        }

        // Requête pour vérifier l'accès
        fetch(`/check-access?uniqueId=${uniqueId}`)
          .then((response) => {
            if (response.ok) {
              return response.text(); // Retourne le contenu HTML du serveur
            } else {
              throw new Error("Accès refusé");
            }
          })
          .then((html) => {
            // Injecter le contenu retourné dans la page
            document.getElementById("importedContent").innerHTML = html;

            // Charger dynamiquement le script
            const script = document.createElement("script");
            script.src = "/views/film.js";
            document.body.appendChild(script);
          })
          .catch((error) => {
            document.getElementById("message").textContent =
              "Accès non autorisé : " + error.message;
            window.location.href = `/403.html`;
          });
      }

      // Lancer la vérification au chargement de la page
      window.onload = checkAccess;
    </script>
  </head>
  <body>
    <div id="message">Vérification de l'accès en cours...</div>
  </body>
</html>
